<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <title>Cadastrar Simulado - Multi Step</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="assets/favicon-8fd74f43.ico" />
    <!-- CSS do seu tema -->
    <link rel="stylesheet" href="assets/theme-d32f8eb8.css" />
    <!-- Bootstrap CSS (via CDN) -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      fieldset {
        display: none;
      }
      fieldset.active {
        display: block;
      }
      #progressbar {
        height: 20px;
      }
    </style>
  </head>
  <body class="bg-light">
    <%- include('partials/sidebar') %>
    <div class="min-vh-100 d-flex flex-column">
      <%- include('partials/header') %>
      <div class="container p-6 my-4">
        <h4 class="mb-4">Cadastrar Simulado - Multi Step</h4>
        <!-- Barra de progresso -->
        <div id="progressbar" class="progress mb-4">
          <div
            id="progress-step"
            class="progress-bar"
            role="progressbar"
            style="width: 25%"
            aria-valuenow="25"
            aria-valuemin="0"
            aria-valuemax="100"
          ></div>
        </div>
        <!-- Formulário multi‑etapas -->
        <form
          id="multiStepForm"
          method="POST"
          action="/cadastrar-simulado-steps"
        >
          <!-- Etapa 1: Selecionar Turma -->
          <fieldset class="active">
            <div class="mb-3">
              <label for="turma" class="form-label">Selecione a Turma</label>
              <select id="turma" name="turma" class="form-select" required>
                <option value="">Escolha uma turma</option>
                <% turmas.forEach(function(turma) { %>
                <option value="<%= turma.id %>"><%= turma.nome %></option>
                <% }); %>
              </select>
            </div>
            <button type="button" class="btn btn-primary next">Próximo</button>
          </fieldset>

          <!-- Etapa 2: Selecionar Alunos -->
          <fieldset>
            <div class="mb-3">
              <label for="alunos" class="form-label">Selecione os Alunos</label>
              <select
                id="alunos"
                name="alunos[]"
                class="form-select"
                multiple
                required
              >
                <!-- Exemplo: se os alunos vierem do back-end, use EJS; aqui, exemplificamos -->
                <option value="1">Aluno 1</option>
                <option value="2">Aluno 2</option>
                <option value="3">Aluno 3</option>
                <option value="4">Aluno 4</option>
              </select>
            </div>
            <div class="d-flex justify-content-between">
              <button type="button" class="btn btn-secondary prev">
                Voltar
              </button>
              <button type="button" class="btn btn-primary next">
                Próximo
              </button>
            </div>
          </fieldset>

          <!-- Etapa 3: Selecionar Questões -->
          <fieldset>
            <div class="mb-3">
              <label for="questoes" class="form-label"
                >Selecione as Questões</label
              >
              <select
                id="questoes"
                name="questoes[]"
                class="form-select"
                multiple
                required
              >
                <!-- Exemplo de opções; popule conforme necessário -->
                <option value="1">Questão 1</option>
                <option value="2">Questão 2</option>
                <option value="3">Questão 3</option>
                <option value="4">Questão 4</option>
              </select>
            </div>
            <div class="d-flex justify-content-between">
              <button type="button" class="btn btn-secondary prev">
                Voltar
              </button>
              <button type="button" class="btn btn-primary next">
                Próximo
              </button>
            </div>
          </fieldset>

          <!-- Etapa 4: Revisão e Confirmação -->
          <fieldset>
            <div class="mb-3">
              <h5>Revisão do Simulado</h5>
              <p id="resumo-turma"></p>
              <p id="resumo-alunos"></p>
              <p id="resumo-questoes"></p>
            </div>
            <div class="d-flex justify-content-between">
              <button type="button" class="btn btn-secondary prev">
                Voltar
              </button>
              <button type="submit" class="btn btn-success">Concluir</button>
            </div>
          </fieldset>
        </form>
      </div>
      <%- include('partials/footer') %>
    </div>

    <!-- jQuery e Bootstrap Bundle JS (via CDN) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      $(document).ready(function () {
        var currentIndex = 0;
        var fieldsets = $("fieldset");
        var totalSteps = fieldsets.length;

        // Função para mostrar a etapa atual e atualizar a barra de progresso
        function showStep(index) {
          fieldsets.removeClass("active");
          fieldsets.eq(index).addClass("active");
          var percent = ((index + 1) / totalSteps) * 100;
          $("#progress-step").css("width", percent + "%");

          // Se for a última etapa, atualiza os resumos
          if (index === totalSteps - 1) {
            var turma = $("#turma option:selected").text();
            var alunosText = $("#alunos option:selected")
              .map(function () {
                return $(this).text();
              })
              .get()
              .join(", ");
            var questoesText = $("#questoes option:selected")
              .map(function () {
                return $(this).text();
              })
              .get()
              .join(", ");

            $("#resumo-turma").html("<strong>Turma:</strong> " + turma);
            $("#resumo-alunos").html("<strong>Alunos:</strong> " + alunosText);
            $("#resumo-questoes").html(
              "<strong>Questões:</strong> " + questoesText
            );
          }
        }

        // Botão "Próximo"
        $(".next").click(function () {
          // Validação simples: verifica se os campos obrigatórios estão preenchidos
          var currentFieldset = fieldsets.eq(currentIndex);
          var valid = true;
          currentFieldset.find("select[required]").each(function () {
            if (!$(this).val() || $(this).val().length === 0) {
              valid = false;
              alert("Por favor, preencha os campos obrigatórios.");
              return false;
            }
          });
          if (!valid) return false;

          currentIndex++;
          if (currentIndex >= totalSteps) currentIndex = totalSteps - 1;
          showStep(currentIndex);
        });

        // Botão "Voltar"
        $(".prev").click(function () {
          currentIndex--;
          if (currentIndex < 0) currentIndex = 0;
          showStep(currentIndex);
        });

        // Inicializa o primeiro passo
        showStep(currentIndex);
      });
    </script>
  </body>
</html>
