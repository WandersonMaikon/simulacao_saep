<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>Análise Geral</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- ApexCharts -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <style>
      body {
        background-color: #f0f0f0;
      }
      .title {
        font-size: 2rem;
        font-weight: bold;
      }
      .card-custom {
        border-radius: 0.5rem;
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        background-color: #fff;
        padding: 1.5rem;
      }
      .nav-tabs {
        border-bottom: 2px solid #dee2e6;
      }
      .nav-tabs .nav-link {
        font-weight: 600;
        border: 2px solid transparent;
        border-top-left-radius: 0.5rem;
        border-top-right-radius: 0.5rem;
        padding: 0.5rem 1rem;
        transition: border-color 0.3s, color 0.3s;
      }
      .nav-tabs .nav-link.active {
        border-color: #dee2e6 #dee2e6 #fff;
      }
      /* Container das abas com fundo cinza */
      .tabs-custom {
        background-color: #f0f0f0;
        padding: 1rem;
        border-radius: 0.5rem;
      }
      /* Itens de performance com fonte ajustada */
      .performance-item {
        text-align: center;
        padding: 0.5rem;
        background-color: #f8f9fa;
        border-radius: 0.25rem;
        margin-bottom: 0.5rem;
      }
      .performance-item .label {
        font-size: 0.9rem;
        font-weight: 600;
        color: #495057;
      }
      .performance-item .value {
        font-size: 1.1rem;
        font-weight: 700;
        color: #212529;
      }
      .link-voltar {
        cursor: pointer;
        display: inline-block;
        margin-bottom: 1rem;
      }
      .link-voltar:hover {
        text-decoration: underline;
      }
      /* Novo card para o Donut Chart */
      .chart-card {
        border-radius: 0.5rem;
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        background-color: #fff;
        margin-top: 2rem;
      }
      .chart-card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 1.25rem;
      }
      .chart-card-header h5 {
        margin: 0;
        font-size: 1.25rem;
        font-weight: 500;
        text-transform: capitalize;
      }
      .chart-card-body {
        padding: 1rem 1.25rem;
        border-top: 2px dashed #dee2e6;
      }
      #donut_chart {
        min-height: 287px;
      }
    </style>
  </head>
  <body>
    <div class="container my-5">
      <!-- Link de voltar no topo -->
      <div class="mb-3">
        <a href="/aluno/simulado" class="link-voltar">
          <span>Voltar para início</span>
        </a>
      </div>
      <h2 class="title mb-3">Análise Geral</h2>
      <div class="card-custom">
        <div class="row">
          <!-- Coluna da esquerda: Cabeçalho -->
          <div class="col-lg-5">
            <h5>Resultados do Simulado</h5>
            <p class="text-muted">Confira abaixo a sua performance.</p>
          </div>
          <!-- Coluna da direita: Abas de Performance -->
          <div class="col-lg-7">
            <div class="tabs-custom">
              <ul class="nav nav-tabs" id="analiseTab" role="tablist">
                <li class="nav-item" role="presentation">
                  <button
                    class="nav-link active"
                    id="normal-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#normal"
                    type="button"
                    role="tab"
                    aria-controls="normal"
                    aria-selected="true"
                  >
                    Pontuação Normal
                  </button>
                </li>
                <li class="nav-item" role="presentation">
                  <button
                    class="nav-link"
                    id="liquida-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#liquida"
                    type="button"
                    role="tab"
                    aria-controls="liquida"
                    aria-selected="false"
                  >
                    Pontuação Líquida
                  </button>
                </li>
              </ul>
              <div class="tab-content pt-3" id="analiseTabContent">
                <!-- Aba Pontuação Normal -->
                <div
                  class="tab-pane fade show active"
                  id="normal"
                  role="tabpanel"
                  aria-labelledby="normal-tab"
                >
                  <div class="row">
                    <div class="col">
                      <div class="performance-item">
                        <div class="label">Nota final</div>
                        <div class="value"><%= nota %> / 100</div>
                      </div>
                    </div>
                    <div class="col">
                      <div class="performance-item">
                        <div class="label">Acertos</div>
                        <div class="value">
                          <%= correctCount %> / <%= totalQuestions %>
                        </div>
                      </div>
                    </div>
                    <div class="col">
                      <div class="performance-item">
                        <div class="label">Duração</div>
                        <div class="value"><%= duracaoAluno %></div>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- Aba Pontuação Líquida -->
                <div
                  class="tab-pane fade"
                  id="liquida"
                  role="tabpanel"
                  aria-labelledby="liquida-tab"
                >
                  <div class="row">
                    <div class="col">
                      <div class="performance-item">
                        <div class="label">Nota final</div>
                        <div class="value"><%= nota %> / 100</div>
                      </div>
                    </div>
                    <div class="col">
                      <div class="performance-item">
                        <div class="label">Acertos</div>
                        <div class="value">
                          <%= correctCount %> / <%= totalQuestions %>
                        </div>
                      </div>
                    </div>
                    <div class="col">
                      <div class="performance-item">
                        <div class="label">Erros</div>
                        <div class="value">
                          <%= wrongAnswers %> / <%= totalQuestions %>
                        </div>
                      </div>
                    </div>
                    <div class="col">
                      <div class="performance-item">
                        <div class="label">Em branco</div>
                        <div class="value">
                          <%= blank %> / <%= totalQuestions %>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- tab-content -->
            </div>
            <!-- tabs-custom -->
          </div>
        </div>
      </div>

      <!-- Novo Card Custom para o Donut Chart -->
      <div class="card-custom chart-card">
        <div class="card-header">
          <h5>Percentual de rendimento</h5>
        </div>
        <div class="card-body">
          <div id="donut_chart" class="apex-charts" dir="ltr"></div>
        </div>
      </div>
    </div>
    <!-- Bootstrap Bundle com Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      var wrong = Number("<%= wrongAnswers %>");
      var correct = Number("<%= correctCount %>");
      var blankVal = Number("<%= blank %>");
      var seriesData = [wrong, correct, blankVal];

      var options = {
        chart: {
          type: "donut",
          height: "100%",
        },
        series: seriesData,
        labels: ["Erros", "Acertos", "Em Branco"],
        responsive: [
          {
            breakpoint: 480,
            options: {
              chart: {
                width: 300,
              },
              legend: {
                position: "bottom",
              },
            },
          },
        ],
      };

      var chart = new ApexCharts(
        document.querySelector("#donut_chart"),
        options
      );
      chart.render();
    </script>
    <!-- Novo Card Custom para o Bar Chart -->
    <div class="card-custom chart-card mt-4">
      <div class="card-header">
        <h5 class="text-capitalize">Desempenho por UC</h5>
      </div>
      <div class="card-body">
        <div id="bar_chart" class="apex-charts" style="min-height: 350px"></div>
      </div>
    </div>

    <!-- Inclua a biblioteca ApexCharts -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <!-- Novo Card Custom para o Bar Chart -->
    <div class="card-custom chart-card mt-4">
      <div class="card-header">
        <h5>Desempenho por UC</h5>
      </div>
      <div class="card-body">
        <div id="bar_chart" style="min-height: 350px"></div>
      </div>
    </div>

    <div class="container my-5">
      <!-- Elemento para armazenar os dados do gráfico via atributos -->
      <div
        id="chart-data"
        data-uc-labels="<%= JSON.stringify(ucLabels || []) %>"
        data-acertos="<%= JSON.stringify(acertosData || []) %>"
        data-erros="<%= JSON.stringify(errosData || []) %>"
      ></div>

      <!-- Novo Card Custom para o Bar Chart -->
      <div class="card-custom chart-card">
        <div class="chart-card-header">
          <h5>Desempenho por UC</h5>
        </div>
        <div class="chart-card-body">
          <div id="bar_chart"></div>
        </div>
      </div>
    </div>
    <!-- Bootstrap Bundle com Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Recupera os dados armazenados no elemento #chart-data
      var dataEl = document.getElementById("chart-data");
      var ucLabels = JSON.parse(dataEl.getAttribute("data-uc-labels"));
      var acertosDataRaw = JSON.parse(dataEl.getAttribute("data-acertos"));
      var errosDataRaw = JSON.parse(dataEl.getAttribute("data-erros"));

      // Converte os dados para números
      var acertosData = acertosDataRaw.map(function (val) {
        return Number(val);
      });
      var errosData = errosDataRaw.map(function (val) {
        return Number(val);
      });

      var options = {
        chart: {
          type: "bar",
          height: 350,
        },
        plotOptions: {
          bar: {
            horizontal: false,
            columnWidth: "55%",
            endingShape: "rounded",
          },
        },
        dataLabels: {
          enabled: true,
          style: {
            fontSize: "12px",
            colors: ["#fff"],
          },
        },
        stroke: {
          show: true,
          width: 2,
          colors: ["transparent"],
        },
        series: [
          {
            name: "Acertos",
            data: acertosData,
          },
          {
            name: "Erros",
            data: errosData,
          },
        ],
        xaxis: {
          categories: ucLabels,
        },
        yaxis: {
          title: {
            text: "Quantidade",
          },
        },
        fill: {
          opacity: 1,
        },
        tooltip: {
          y: {
            formatter: function (val) {
              return val;
            },
          },
        },
      };

      var chart = new ApexCharts(document.querySelector("#bar_chart"), options);
      chart.render();
    </script>
  </body>
</html>
